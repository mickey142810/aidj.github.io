<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Mood DJ ‚Äî Enhanced Edition</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">

<!-- FACE API -->
<script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

<style>
/* --- STYLING (improved, merged, cleaned) --- */
:root{
  --bg-1:#081223;
  --bg-2:#0d1a28;
  --card:#102533;
  --muted:#9fb3c8;
  --accent:#6ee7b7;
  --accent-2:#5aa9ff;
  --glass: rgba(255,255,255,0.04);
  --danger:#ff7a7a;
}
html,body{margin:0;height:100%;font-family:Inter,system-ui;-webkit-font-smoothing:antialiased;}
body{
  background: radial-gradient(1200px 600px at 10% 10%, #0b2b3a 0%, transparent 10%),
              radial-gradient(900px 500px at 90% 90%, #07203a 0%, transparent 10%),
              linear-gradient(180deg,var(--bg-1),var(--bg-2));
  padding:28px;
  display:flex;justify-content:center;align-items:flex-start;
  color:#d8eef7;
}
.app{width:100%;max-width:1100px;display:grid;grid-template-columns:420px 1fr;gap:22px;}
.panel, .stage{
  background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.05);
  border-radius:16px;padding:18px;
}
.logo{width:58px;height:58px;background:linear-gradient(135deg,var(--accent),var(--accent-2));border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#012;font-size:20px;}
.btn{padding:10px 14px;border-radius:12px;cursor:pointer;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.03);color:var(--accent-2);font-weight:600;}
.btn.prim{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#012;}
.btn.ghost{background:transparent;border:1px dashed rgba(255,255,255,0.05);color:var(--muted);}
video{width:100%;height:240px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,0.05);background:#0005;}
textarea{width:100%;background:#0004;border:1px solid #fff1;padding:10px;border-radius:10px;color:#dff7ff;}
.track{padding:12px;background:#ffffff06;border:1px solid #ffffff10;border-radius:12px;}
.play-btn{margin-top:8px;background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:8px 10px;border:none;border-radius:10px;color:#012;font-weight:700;}
</style>
</head>

<body>
<div class="app">

  <!-- LEFT PANEL -->
  <section class="panel">
    <div style="display:flex;gap:12px;align-items:center;">
      <div class="logo">DJ</div>
      <div>
        <h2 style="margin:0;font-size:20px;">AI Mood DJ</h2>
        <p style="margin:0;color:var(--muted);font-size:13px;">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏ß‡∏° Presets + Emotion AI</p>
      </div>
      <button id="openSettings" class="btn" style="margin-left:auto;">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
    </div>

    <div class="howto" style="margin-top:10px;color:var(--muted);font-size:13px;">
      1) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Preset ‚Üí 2) ‡πÉ‡∏™‡πà‡πÄ‡∏û‡∏•‡∏á ‚Üí 3) ‡∏ñ‡πà‡∏≤‡∏¢/‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ ‚Üí 4) ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏ö‡∏ö AI
    </div>

    <video id="video" autoplay muted playsinline></video>

    <div class="controls" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;">
      <label class="btn" for="uploadFile">üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</label>
      <input id="uploadFile" type="file" accept="image/*" style="display:none;">
      <button id="snap" class="btn prim">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û</button>
      <button id="demoFace" class="btn">üëÅÔ∏è ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
    </div>

    <div id="statusArea" style="margin-top:10px;color:var(--muted)">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•...</div>
  </section>

  <!-- RIGHT PANEL ‚Üí MOOD RESULT -->
  <section class="stage">
    <div style="display:flex;gap:16px;align-items:center;">
      <div id="moodEmoji" style="font-size:48px;">üôÇ</div>
      <div>
        <h2 id="moodTitle" style="margin:0;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>
        <p id="moodDesc" style="margin:0;color:var(--muted);">‡∏£‡∏≠‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...</p>
      </div>
    </div>

    <div id="detectedConfidence" style="margin-top:10px;color:var(--muted);"></div>

    <h3 style="margin-top:14px;">‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
    <div id="tracksGrid" style="display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));"></div>
  </section>
</div>

<!-- SETTINGS DRAWER -->
<aside id="drawer" style="position:fixed;right:20px;top:20px;width:360px;max-width:90vw;background:#ffffff08;padding:16px;border-radius:16px;transform:translateX(420px);transition:.35s;">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <h3>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏•‡∏á + Preset</h3>
    <button id="closeDrawer" class="btn ghost">‚úñÔ∏è</button>
  </div>

  <label class="small">Preset Pack:</label>
  <select id="presetSelect" class="btn" style="width:100%;margin-top:4px;">
    <option value="none">-- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ preset --</option>
    <option value="basic">üéß Basic Pack</option>
    <option value="chill">üòé Chill Pack</option>
    <option value="thaipop">üé§ Thai Pop Pack</option>
    <option value="gamer">üïπÔ∏è Gamer Pack</option>
  </select>

  <button id="applyPreset" class="btn prim" style="width:100%;margin-top:10px;">‡πÇ‡∏´‡∏•‡∏î Preset</button>

  <label class="small" style="margin-top:10px;">Happiness</label>
  <textarea id="happinessLinks"></textarea>

  <label class="small">Sadness</label>
  <textarea id="sadnessLinks"></textarea>

  <label class="small">Anger</label>
  <textarea id="angerLinks"></textarea>

  <label class="small">Neutral</label>
  <textarea id="neutralLinks"></textarea>

  <button id="saveSettings" class="btn prim" style="width:100%;margin-top:10px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</aside>

<script>
/* ---------------------------------------
      LOAD FACE API MODELS
--------------------------------------- */
async function loadModels() {
  const MODEL_URL = "https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/models";
  await faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL);
  await faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL);
  await faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL);
  document.getElementById("statusArea").textContent = "‚úî ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
}
loadModels();

/* CAMERA */
navigator.mediaDevices.getUserMedia({ video:true }).then(stream => video.srcObject = stream);

/* PRESET DATA */
const ids = ["happinessLinks","sadnessLinks","angerLinks","neutralLinks"];
const presetData = {
  basic:{happiness:["https://youtube.com/playlist?list=PLgzTt0k8mXzF2fleyxQ17JxeccHFC8Gxp"],sadness:["https://youtu.be/POETazMpykQ"],anger:["https://youtu.be/t9mCFx_zF8U"],neutral:["https://youtu.be/n61ULEU7CO0"]},
  chill:{happiness:["https://youtu.be/xNSx7NYZ4fM"],sadness:["https://youtu.be/_c7xxwWbljk"],anger:["https://youtu.be/6m2Ma8uX74s"],neutral:["https://youtu.be/EkVbIfRPQAg"]},
  thaipop:{happiness:["https://youtu.be/nJFJvO83o_s"],sadness:["https://youtu.be/eY7iqYmQNhE"],anger:["https://youtube.com/playlist?list=PLZSdxWoL6_WD8dpQE9iluLw3yYVQJphYp"],neutral:["https://youtu.be/aHoyTRlHCr4"]},
  gamer:{happiness:["https://youtu.be/ih2xubMaZWI"],sadness:["https://youtu.be/M1YriKcNIco"],anger:["https://youtube.com/playlist?list=PL6Y6az3uyYAZJailKdu-zkc9JnvCyvgoN"],neutral:["https://youtu.be/3fxq7kqyWO8"]}
};

/* LOAD SAVED */
function loadSaved() {
  ids.forEach(id => document.getElementById(id).value = localStorage.getItem(id) || "");
}
loadSaved();

/* APPLY PRESET */
function applyPreset(key){
  const p = presetData[key];
  if(!p) return;
  document.getElementById("happinessLinks").value = p.happiness.join("\n");
  document.getElementById("sadnessLinks").value = p.sadness.join("\n");
  document.getElementById("angerLinks").value = p.anger.join("\n");
  document.getElementById("neutralLinks").value = p.neutral.join("\n");
}

document.getElementById("applyPreset").onclick = () => {
  const v = document.getElementById("presetSelect").value;
  if(v !== "none") applyPreset(v);
};

document.getElementById("saveSettings").onclick = () => {
  ids.forEach(id => localStorage.setItem(id, document.getElementById(id).value));
  drawer.style.transform = "translateX(420px)";
};

document.getElementById("openSettings").onclick = ()=> drawer.style.transform="translateX(0)";
document.getElementById("closeDrawer").onclick = ()=> drawer.style.transform="translateX(420px)";

/* UTIL */
function getRandom(id){
  const list = (document.getElementById(id).value || "")
    .split("\n").filter(Boolean);
  return list[Math.floor(Math.random()*list.length)];
}

function updateMood(mood,conf){
  document.getElementById("moodTitle").textContent = mood;
  document.getElementById("detectedConfidence").textContent = "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à: "+conf+"%";
  const emo = { happiness:"üòÑ", sadness:"üò¢", anger:"üò°", neutral:"üòê" };
  document.getElementById("moodEmoji").textContent = emo[mood]||"üôÇ";

  let field = {
    happiness:"happinessLinks",
    sadness:"sadnessLinks",
    anger:"angerLinks",
    neutral:"neutralLinks"
  }[mood];

  const link = getRandom(field);
  const grid = document.getElementById("tracksGrid");
  grid.innerHTML = "";

  if(link){
    grid.innerHTML = `
      <div class="track">
        <div>${link}</div>
        <button class="play-btn" onclick="window.open('${link}')">‚ñ∂Ô∏è ‡πÄ‡∏•‡πà‡∏ô</button>
      </div>`;
  }
}

/* ---------------------------------------
      EMOTION ANALYSIS
--------------------------------------- */
async function analyzeImage(input){
  const detection = await faceapi
    .detectSingleFace(input, new faceapi.TinyFaceDetectorOptions())
    .withFaceLandmarks()
    .withFaceExpressions();

  if(!detection){
    updateMood("neutral",0);
    document.getElementById("statusArea").textContent="‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡πâ‡∏≤";
    return;
  }

  const exp = detection.expressions;
  const sorted = Object.entries(exp).sort((a,b)=>b[1]-a[1]);
  const [topMood, confidence] = sorted[0];

  const map = {
    happy:"happiness",
    sad:"sadness",
    angry:"anger",
    neutral:"neutral",
    surprised:"happiness",
    disgusted:"anger",
    fearful:"sadness"
  };

  const mood = map[topMood] || "neutral";
  updateMood(mood,Math.round(confidence*100));
  document.getElementById("statusArea").textContent="‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úì";
}

/* SNAP CAMERA */
document.getElementById("snap").onclick = async ()=>{
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);
  analyzeImage(canvas);
};

/* UPLOAD */
document.getElementById("uploadFile").onchange = async ev=>{
  const file = ev.target.files[0];
  if(!file) return;

  const img = new Image();
  img.onload = ()=> analyzeImage(img);
  img.src = URL.createObjectURL(file);
};

/* DEMO */
document.getElementById("demoFace").onclick = ()=>{
  const demo = new Image();
  demo.crossOrigin="anonymous";
  demo.src="https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/examples/images/bbt1.jpg";
  demo.onload = ()=> analyzeImage(demo);
};
</script>

</body>
</html>
